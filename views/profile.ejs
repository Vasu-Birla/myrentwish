<%- include ("header.ejs") %>
<%- include ("navbar.ejs") %>

            <!-- right content -->
            <div id="content">
            <!-- dashboard inner -->
               <div class="midde_cont">
                  <div class="container-fluid">
                   
                     <!-- row -->
<!-- row -->

                     <div class="row column1">
                        <div class="col-md-12">
                           <div class="white_shd full margin_bottom_30">
                              <div class="full graph_head">
                                 <div class="heading1 margin_0">
                                    <h2>Company Profile </h2>
                                 </div>
                              </div>
                              	
                              <div class="full price_table padding_infor_info">

                                 		<!-- alert msgs  -->
					<div id="successMessage" class="alert alert-success d-none">
						Profile picture updated successfully!
					</div>
					  
					  <div id="errorMessage" class="alert alert-danger d-none">
						Error updating profile picture. Please try again.
					  </div>
					  
					<!-- /alert msgs  -->
                                 <div class="row">
                                    <!-- user profile section --> 
                                   

                                    <div class="col-lg-5">
                                       
                                       <div class="full dis_flex center_text">
                                         
                                          <div class="profile_contant">
                                               <!-- profile image -->
                                             <div class="profile-pic">
                                                <label class="-label" for="file">
                                                  <span class="glyphicon glyphicon-camera"></span>
                                                  <!-- <span>Change Image</span> -->
                                                </label>
                                                <input id="file" type="file" onchange="loadFile(event)"/>
                                                <img src="http://<%= host %>/uploads/<%- company.image %>" id="output" alt="Change" width="200" />
                                               </div>
                                                 <!-- /profile image -->
                                             <div class="contact_inner">
                                                <h3><%- company.contact_person %></h3>
                                                <p><strong>About: </strong>Admin of <%- company.company_name %> </p>
                                                <ul class="list-unstyled">
                                                   <li><i class="fa fa-envelope-o"></i> : <%- company.company_email %></li>
                                                   <li><i class="fa fa-phone"></i> :  <%- company.company_number %></li>
                                                </ul>
                                             </div>
                                             <div class="user_progress_bar">
                                                <div class="progress_bar">
                                                   <!-- Skill Bars -->
                                                   <!-- <span class="skill" style="width:100%;">Web Applications <span class="info_valume">85%</span></span>                   
                                                   <div class="progress skill-bar ">
                                                      <div class="progress-bar progress-bar-animated progress-bar-striped" role="progressbar" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100" style="width: 85%;">
                                                      </div>
                                                   </div> -->
                                                                                        
                                              
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                       <!-- profile contant section -->
                                         <div class="col-lg-7">
                                       <div class="full inner_elements margin_top_30">
                                          <div class="tab_style2">
                                             <div class="tabbar">
                                                <nav>
                                                   <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                                      <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#profile_section" role="tab" aria-selected="true">Profile</a>

                                                      <!-- <a class="nav-item nav-link" id="nav-activity-tab" data-toggle="tab" href="#recent_activity" role="tab" aria-selected="false"> recent_activity</a> -->

                                                      <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#password_section" role="tab" aria-selected="false">Password</a>

                                                   </div>
                                                </nav>
                                                <div class="tab-content" id="nav-tabContent">
                                                   <% if (output === ' Profile Updated Successfully !!' || output === 'Password changed successfully') { %>
                                                      <p class="success-text"><%= output %></p>
                                                   <% } else { %>
                                                      <p class="error-text"><%= output %></p>
                                                   <% } %>
                                                   <!-- <div class="tab-pane fade" id="recent_activity" role="tabpanel" aria-labelledby="nav-activity-tab">
                                                      <div class="msg_list_main">
                                                         <ul class="msg_list">
                                                            <li>
                                                               <span><img src="images/layout_img/msg2.png" class="img-responsive" alt="#"></span>
                                                               <span>
                                                               <span class="name_user">Taison Jack</span>
                                                               <span class="msg_user">Sed ut perspiciatis unde omnis.</span>
                                                               <span class="time_ago">12 min ago</span>
                                                               </span>
                                                            </li>                                         

                                                         </ul>
                                                      </div>
                                                   </div> -->
                                                   <div class="tab-pane fade show active" id="profile_section" role="tabpanel" aria-labelledby="nav-home-tab">
                                                  
                                                      <div class="card">
                                                         <div class="card-body">
                                                            <h5 class="card-title d-flex justify-content-between">
                                                               <span>Personal Details</span> 
                                                               <a class="edit-link" data-toggle="modal" href="#edit_personal_details"><i class="fa fa-edit mr-1"></i>Edit</a>
                                                            </h5>
                                                            <div class="row">
                                                               <p class="col-sm-3 text-muted text-sm-right mb-0 mb-sm-3">Company name </p>
                                                               <p class="col-sm-9"><%- company.company_name %></p>
                                                            </div>
                                                            <div class="row">
                                                               <p class="col-sm-3 text-muted text-sm-right mb-0 mb-sm-3">Contact Person </p>
                                                               <p class="col-sm-9"><%- company.contact_person %></p>
                                                            </div>
                                                            <!-- <div class="row">
                                                               <p class="col-sm-3 text-muted text-sm-right mb-0 mb-sm-3">Date of Birth</p>
                                                               <p class="col-sm-9">24 Jul 1983</p>
                                                            </div> -->
                                                            <div class="row">
                                                               <p class="col-sm-3 text-muted text-sm-right mb-0 mb-sm-3">Email ID</p>
                                                               <p class="col-sm-9"> <%- company.company_email %> </p>
                                                            </div>
                                                            <div class="row">
                                                               <p class="col-sm-3 text-muted text-sm-right mb-0 mb-sm-3">Mobile</p>
                                                               <p class="col-sm-9"><%- company.company_number %></p>
                                                            </div>
                                                            <div class="row">
                                                               <p class="col-sm-3 text-muted text-sm-right mb-0">Address</p>
                                                               <p class="col-sm-9 mb-0"> <%- company.company_address %></p>
                                                            </div>
                                                         </div>
                                                      </div>
                                                               
 
                                                 </div>

                                                 <div class="tab-pane fade" id="password_section" role="tabpanel" aria-labelledby="nav-home-tab">
                                                   
                                                   <div class="card">
                                                      <div class="card-body">
                                                         <h5 class="card-title">Change Password</h5>
                                                         <div class="row">
                                                            <div class="col-md-10 col-lg-6">
                                                               <form method="post" action="/changepass">
                                                                  <div class="form-group">
                                                                     <label>Old Password</label>
                                                                     <input name="opass" type="password" class="form-control">
                                                                  </div>
                                                                  <div class="form-group">
                                                                     <label>New Password</label>
                                                                     <input name="npass" type="password" class="form-control">
                                                                  </div>
                                                                  <div class="form-group">
                                                                     <label>Confirm Password</label>
                                                                     <input name="cpass" type="password" class="form-control">
                                                                  </div>
                                                                  <button class="btn btn-primary" type="submit">Save Changes</button>
                                                               </form>
                                                            </div>
                                                         </div>
                                                      </div>
                                                   </div>                                    
                                                 
                                                </div>
                                                
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>


                                 </div>

                                 <!-- Edit Details Modal -->
                                      
                                         <div class="modal fade" id="edit_personal_details" aria-hidden="true" role="dialog">
                                            <div class="modal-dialog modal-dialog-centered" role="document">
                                               <div class="modal-content">
                                                  <div class="modal-header">
                                                     <h5 class="modal-title">Personal Details</h5>
                                                     <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">×</span>
                                                     </button>
                                                  </div>
                                                  <div class="modal-body">
                                                     <form method="post" action="/profile" enctype="multipart/form-data" >
                                                        <div class="row form-row">
                                                           <div class="col-12 col-sm-6">
                                                              <div class="form-group">
                                                                 <label> Company Name</label>
                                                                 <input name="company_name" type="text" class="form-control" value="<%- company.company_name %>">
                                                              </div>
                                                           </div>
                                                           <div class="col-12 col-sm-6">
                                                              <div class="form-group">
                                                                 <label> Contact Person </label>
                                                                 <input name="contact_person"  type="text" class="form-control" value="<%- company.contact_person %>">
                                                              </div>
                                                           </div>
                                               
                                                         
                                                           <div class="col-12 col-sm-6">
                                                              <div class="form-group">
                                                                 <label>Login Email </label>
                                                                 <input name="company_email" readonly type="email" class="form-control" value="<%- company.company_email %>">
                                                              </div>
                                                           </div>
                                                           <div class="col-12 col-sm-6">
                                                              <div class="form-group">
                                                                 <label>Mobile</label>
                                                                 <input name="company_number"  type="text" value="<%- company.company_number %>" class="form-control">
                                                              </div>
                                                           </div>
                                                           <!-- <div class="col-12">
                                                              <div class="form-group">
                                                              <label>About </label>
                                                                 <input name="about"  type="text" class="form-control" value="<%- user.about %>">
                                                              </div>
                                                           </div> -->
                                                           <!-- <div class="col-12">
                                                              <h5 class="form-title"><span>Address</span></h5>
                                                           </div>																	 -->
        
                                                           <div class="col-12">
                                                              <div class="form-group">
                                                              <label>Address</label>
                                                                 <input name="company_address"  type="text" class="form-control" value="<%- company.company_address %>">
                                                              </div>
                                                           </div>
                                                           
                                                           <div class="form-group col-md-6 col-12">
                                                              <label>Update Profile Picture </label>
                                                              <input  type="file"  class="form-control"  id="avatar" name="image" accept="image/png, image/jpeg" />
                                                           </div>
                                                        </div>
                                                        <button type="submit" class="btn btn-primary btn-block">Save Changes</button>
                                                     </form>
                                                  </div>
                                               </div>
                                            </div>
                                         </div>
                                         <!-- /Edit Details Modal -->


                                       <!-- end user profile section -->
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-2"></div>
                        </div>
                        <!-- end row -->
                     </div>
                     <!-- footer -->
                       <div class="footer">
                                 <div class="container-fluid">
                        <p>Copyright ©2023 All rights reserved | Design & Develop by
                           <a href="https://cyberimpulses.com/"> CISS</a>
                        </p>
                     </div>
                  </div>
                  </div>
                  <!-- end dashboard inner -->
               </div>
            </div>
         </div>
      </div>
      <!-- jQuery -->
      <script src="js/jquery.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.min.js"></script>
      <!-- wow animation -->
      <script src="js/animate.js"></script>
      <!-- select country -->
      <script src="js/bootstrap-select.js"></script>
      <!-- owl carousel -->
      <script src="js/owl.carousel.js"></script> 
      <!-- chart js -->
      <script src="js/Chart.min.js"></script>
      <script src="js/Chart.bundle.min.js"></script>
      <script src="js/utils.js"></script>
      <script src="js/analyser.js"></script>
      <!-- nice scrollbar -->
      <script src="js/perfect-scrollbar.min.js"></script>
      <script>
         var ps = new PerfectScrollbar('#sidebar');
      </script>
      <!-- custom js -->
      <script src="js/custom.js"></script>
      <!-- calendar file css -->    
      <script src="js/semantic.min.js"></script>
   </body>
</html>


<script>

var loadFile = function (event) {
  var image = document.getElementById("output");
  var file = event.target.files[0];

  // Create a FormData object to send the file
  var formData = new FormData();
  formData.append("image", file); // Use the name "profileImage" to match your server's expectations

  // Send the AJAX request
  $.ajax({
    url: "/updateCompanypic", // Replace with your actual API endpoint URL
    type: "POST",
    data: formData,
    processData: false,
    contentType: false,
    success: function (response) {
		if(response.msg == 'success'){
			$("#successMessage").removeClass("d-none");
  $("#errorMessage").addClass("d-none");
		}else{
			$("#errorMessage").removeClass("d-none");
  $("#successMessage").addClass("d-none");
		}

    },
    error: function (error) {
        $("#errorMessage").removeClass("d-none");
  $("#successMessage").addClass("d-none");
    },
  });

  // Update the preview image
  image.src = URL.createObjectURL(file);
};



</script>